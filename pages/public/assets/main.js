(()=>{(function(){var l=document.getElementById("unit-toggle");function g(){var t=l.checked;t?document.body.classList.add("metric"):document.body.classList.remove("metric")}l.addEventListener("change",()=>{g(),localStorage.setItem("preferredUnits",l.checked?"metric":"imperial")}),window.addEventListener("DOMContentLoaded",t=>{let s=navigator.language||navigator.userLanguage,n=localStorage.getItem("preferredUnits");n?(console.log("preferred units",n),l.checked=n==="metric"):s==="en-US"?l.checked=!1:l.checked=!0,g();let a=document.getElementById("filter-snow-toggle");if(a){let o=localStorage.getItem("filterSnowOnly")==="true";a.checked=o,o&&document.body.classList.add("filter-snow-only"),a.addEventListener("change",()=>{let e=a.checked;e?document.body.classList.add("filter-snow-only"):document.body.classList.remove("filter-snow-only"),localStorage.setItem("filterSnowOnly",e)})}L()});function L(){let t=document.getElementById("sort-by-date"),s=document.getElementById("forecast-table"),n=document.getElementById("forecast-body");if(!t||!s||!n)return;let a=s.querySelectorAll("thead th");Array.from(a).slice(1).forEach((d,i)=>{let r=document.createElement("option");r.value=i,r.textContent=d.textContent.trim(),t.appendChild(r)});let e=Array.from(n.querySelectorAll("tr"));t.addEventListener("change",()=>{let d=t.value;if(d===""){e.forEach(u=>n.appendChild(u));return}let i=parseInt(d,10),r=Array.from(n.querySelectorAll("tr"));r.sort((u,b)=>{let k=u.dataset.snowValues?u.dataset.snowValues.split(","):[],C=b.dataset.snowValues?b.dataset.snowValues.split(","):[],$=parseFloat(k[i])||0;return(parseFloat(C[i])||0)-$}),r.forEach(u=>n.appendChild(u))})}let f=null,y=!1,c=document.getElementById("search-modal"),x=document.getElementById("search-button"),m=document.getElementById("search-input"),h=document.getElementById("search-results"),w=document.getElementById("search-loading"),p=document.getElementById("search-empty");async function v(){if(!(f||y)){y=!0,w.classList.remove("hidden");try{let s=await(await fetch("/assets/search-data.json")).json();f=s.d.map(n=>({type:n.t==="c"?"country":n.t==="s"?"state":"resort",name:n.n,country:typeof n.c=="number"?s.cl[n.c]:void 0,state:n.s,url:n.u}))}catch(t){console.error("Failed to load search data:",t),f=[]}finally{y=!1,w.classList.add("hidden")}}}function E(t){if(!f)return;let s=t.toLowerCase().trim();if(!s){h.innerHTML="",p.classList.add("hidden");return}let n=f.filter(e=>{let d=e.name.toLowerCase().includes(s),i=e.country&&e.country.toLowerCase().includes(s),r=e.state&&e.state.toLowerCase().includes(s);return d||i||r}).slice(0,50);if(n.length===0){h.innerHTML="",p.classList.remove("hidden");return}p.classList.add("hidden");let a={country:n.filter(e=>e.type==="country"),state:n.filter(e=>e.type==="state"),resort:n.filter(e=>e.type==="resort")},o="";a.country.length>0&&(o+='<div class="mb-4"><h4 class="font-semibold text-sm mb-2 text-base-content/60">Countries</h4><ul class="menu">',a.country.forEach(e=>{o+=`<li><a href="${e.url}" class="flex items-center gap-2"><span>\u{1F30D}</span><span>${e.name}</span></a></li>`}),o+="</ul></div>"),a.state.length>0&&(o+='<div class="mb-4"><h4 class="font-semibold text-sm mb-2 text-base-content/60">States / Regions</h4><ul class="menu">',a.state.forEach(e=>{o+=`<li><a href="${e.url}" class="flex items-center gap-2"><span>\u{1F4CD}</span><span>${e.name}</span><span class="text-xs text-base-content/60">${e.country}</span></a></li>`}),o+="</ul></div>"),a.resort.length>0&&(o+='<div class="mb-4"><h4 class="font-semibold text-sm mb-2 text-base-content/60">Ski Resorts</h4><ul class="menu">',a.resort.forEach(e=>{o+=`<li><a href="${e.url}" class="flex items-center gap-2"><span>\u26F7\uFE0F</span><div class="flex flex-col items-start"><span>${e.name}</span><span class="text-xs text-base-content/60">${e.state}, ${e.country}</span></div></a></li>`}),o+="</ul></div>"),h.innerHTML=o}function S(t,s){let n;return function(...o){let e=()=>{clearTimeout(n),t(...o)};clearTimeout(n),n=setTimeout(e,s)}}let I=S(E,300);x.addEventListener("click",()=>{c.showModal(),v(),m.focus()});function B(){if(!window.visualViewport)return;let t=c.querySelector(".modal-box");t&&(window.visualViewport.addEventListener("resize",()=>{if(c.open){let s=window.visualViewport.height;t.style.maxHeight=`${s-20}px`}}),window.visualViewport.addEventListener("scroll",()=>{c.open&&(t.style.transform=`translateY(${window.visualViewport.offsetTop}px)`)}))}B(),m.addEventListener("input",t=>{I(t.target.value)}),c.addEventListener("close",()=>{m.value="",h.innerHTML="",p.classList.add("hidden");let t=c.querySelector(".modal-box");t&&(t.style.maxHeight="",t.style.transform="")}),document.addEventListener("keydown",t=>{(t.metaKey||t.ctrlKey)&&t.key==="k"&&(t.preventDefault(),c.showModal(),v(),m.focus())})})();})();
