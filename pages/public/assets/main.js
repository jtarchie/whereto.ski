(()=>{(function(){var r=document.getElementById("unit-toggle");function p(){var s=r.checked;s?document.body.classList.add("metric"):document.body.classList.remove("metric")}r.addEventListener("change",()=>{p(),localStorage.setItem("preferredUnits",r.checked?"metric":"imperial")}),window.addEventListener("DOMContentLoaded",s=>{let a=navigator.language||navigator.userLanguage,t=localStorage.getItem("preferredUnits");t?(console.log("preferred units",t),r.checked=t==="metric"):a==="en-US"?r.checked=!1:r.checked=!0,p();let o=document.getElementById("filter-snow-toggle");if(o){let n=localStorage.getItem("filterSnowOnly")==="true";o.checked=n,n&&document.body.classList.add("filter-snow-only"),o.addEventListener("change",()=>{let e=o.checked;e?document.body.classList.add("filter-snow-only"):document.body.classList.remove("filter-snow-only"),localStorage.setItem("filterSnowOnly",e)})}w()});function w(){let s=document.getElementById("sort-by-date"),a=document.getElementById("forecast-table"),t=document.getElementById("forecast-body");if(!s||!a||!t)return;let o=a.querySelectorAll("thead th");Array.from(o).slice(1).forEach((l,d)=>{let c=document.createElement("option");c.value=d,c.textContent=l.textContent.trim(),s.appendChild(c)});let e=Array.from(t.querySelectorAll("tr"));s.addEventListener("change",()=>{let l=s.value;if(l===""){e.forEach(i=>t.appendChild(i));return}let d=parseInt(l,10),c=Array.from(t.querySelectorAll("tr"));c.sort((i,v)=>{let k=i.dataset.snowValues?i.dataset.snowValues.split(","):[],B=v.dataset.snowValues?v.dataset.snowValues.split(","):[],C=parseFloat(k[d])||0;return(parseFloat(B[d])||0)-C}),c.forEach(i=>t.appendChild(i))})}let u=null,y=!1,g=document.getElementById("search-modal"),E=document.getElementById("search-button"),f=document.getElementById("search-input"),m=document.getElementById("search-results"),L=document.getElementById("search-loading"),h=document.getElementById("search-empty");async function b(){if(!(u||y)){y=!0,L.classList.remove("hidden");try{let a=await(await fetch("/assets/search-data.json")).json();u=a.d.map(t=>({type:t.t==="c"?"country":t.t==="s"?"state":"resort",name:t.n,country:typeof t.c=="number"?a.cl[t.c]:void 0,state:t.s,url:t.u}))}catch(s){console.error("Failed to load search data:",s),u=[]}finally{y=!1,L.classList.add("hidden")}}}function x(s){if(!u)return;let a=s.toLowerCase().trim();if(!a){m.innerHTML="",h.classList.add("hidden");return}let t=u.filter(e=>{let l=e.name.toLowerCase().includes(a),d=e.country&&e.country.toLowerCase().includes(a),c=e.state&&e.state.toLowerCase().includes(a);return l||d||c}).slice(0,50);if(t.length===0){m.innerHTML="",h.classList.remove("hidden");return}h.classList.add("hidden");let o={country:t.filter(e=>e.type==="country"),state:t.filter(e=>e.type==="state"),resort:t.filter(e=>e.type==="resort")},n="";o.country.length>0&&(n+='<div class="mb-4"><h4 class="font-semibold text-sm mb-2 text-base-content/60">Countries</h4><ul class="menu">',o.country.forEach(e=>{n+=`<li><a href="${e.url}" class="flex items-center gap-2"><span>\u{1F30D}</span><span>${e.name}</span></a></li>`}),n+="</ul></div>"),o.state.length>0&&(n+='<div class="mb-4"><h4 class="font-semibold text-sm mb-2 text-base-content/60">States / Regions</h4><ul class="menu">',o.state.forEach(e=>{n+=`<li><a href="${e.url}" class="flex items-center gap-2"><span>\u{1F4CD}</span><span>${e.name}</span><span class="text-xs text-base-content/60">${e.country}</span></a></li>`}),n+="</ul></div>"),o.resort.length>0&&(n+='<div class="mb-4"><h4 class="font-semibold text-sm mb-2 text-base-content/60">Ski Resorts</h4><ul class="menu">',o.resort.forEach(e=>{n+=`<li><a href="${e.url}" class="flex items-center gap-2"><span>\u26F7\uFE0F</span><div class="flex flex-col items-start"><span>${e.name}</span><span class="text-xs text-base-content/60">${e.state}, ${e.country}</span></div></a></li>`}),n+="</ul></div>"),m.innerHTML=n}function S(s,a){let t;return function(...n){let e=()=>{clearTimeout(t),s(...n)};clearTimeout(t),t=setTimeout(e,a)}}let I=S(x,300);E.addEventListener("click",()=>{g.showModal(),b(),f.focus()}),f.addEventListener("input",s=>{I(s.target.value)}),g.addEventListener("close",()=>{f.value="",m.innerHTML="",h.classList.add("hidden")}),document.addEventListener("keydown",s=>{(s.metaKey||s.ctrlKey)&&s.key==="k"&&(s.preventDefault(),g.showModal(),b(),f.focus())})})();})();
