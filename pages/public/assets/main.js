(()=>{(function(){var l=document.getElementById("unit-toggle");function p(){var t=l.checked;t?document.body.classList.add("metric"):document.body.classList.remove("metric")}l.addEventListener("change",()=>{p(),localStorage.setItem("preferredUnits",l.checked?"metric":"imperial")}),window.addEventListener("DOMContentLoaded",t=>{let n=navigator.language||navigator.userLanguage,s=localStorage.getItem("preferredUnits");s?(console.log("preferred units",s),l.checked=s==="metric"):n==="en-US"?l.checked=!1:l.checked=!0,p();let a=document.getElementById("filter-snow-toggle");if(a){let o=localStorage.getItem("filterSnowOnly")==="true";a.checked=o,o&&document.body.classList.add("filter-snow-only"),a.addEventListener("change",()=>{let e=a.checked;e?document.body.classList.add("filter-snow-only"):document.body.classList.remove("filter-snow-only"),localStorage.setItem("filterSnowOnly",e)})}L()});function L(){let t=document.getElementById("forecast-table"),n=document.getElementById("forecast-body");if(!t||!n)return;let s=t.querySelectorAll("thead th.sortable-header");if(s.length===0)return;let a=Array.from(n.querySelectorAll("tr")),o=null;s.forEach(e=>{e.addEventListener("click",()=>{let i=parseInt(e.dataset.colIndex,10);if(s.forEach(r=>{r.querySelector(".sort-indicator").textContent="",r.classList.remove("sorting-active")}),o===i){a.forEach(r=>n.appendChild(r)),o=null;return}o=i,e.querySelector(".sort-indicator").textContent="\u2193",e.classList.add("sorting-active");let h=Array.from(n.querySelectorAll("tr"));h.sort((r,v)=>{let k=r.dataset.snowValues?r.dataset.snowValues.split(","):[],B=v.dataset.snowValues?v.dataset.snowValues.split(","):[],C=parseFloat(k[i])||0;return(parseFloat(B[i])||0)-C}),h.forEach(r=>n.appendChild(r))})})}let d=null,y=!1,c=document.getElementById("search-modal"),b=document.getElementById("search-button"),u=document.getElementById("search-input"),f=document.getElementById("search-results"),g=document.getElementById("search-loading"),m=document.getElementById("search-empty");async function w(){if(!(d||y)){y=!0,g.classList.remove("hidden");try{let n=await(await fetch("/assets/search-data.json")).json();d=n.d.map(s=>({type:s.t==="c"?"country":s.t==="s"?"state":"resort",name:s.n,country:typeof s.c=="number"?n.cl[s.c]:void 0,state:s.s,url:s.u}))}catch(t){console.error("Failed to load search data:",t),d=[]}finally{y=!1,g.classList.add("hidden")}}}function x(t){if(!d)return;let n=t.toLowerCase().trim();if(!n){f.innerHTML="",m.classList.add("hidden");return}let s=d.filter(e=>{let i=e.name.toLowerCase().includes(n),h=e.country&&e.country.toLowerCase().includes(n),r=e.state&&e.state.toLowerCase().includes(n);return i||h||r}).slice(0,50);if(s.length===0){f.innerHTML="",m.classList.remove("hidden");return}m.classList.add("hidden");let a={country:s.filter(e=>e.type==="country"),state:s.filter(e=>e.type==="state"),resort:s.filter(e=>e.type==="resort")},o="";a.country.length>0&&(o+='<div class="mb-4"><h4 class="font-semibold text-sm mb-2 text-base-content/60">Countries</h4><ul class="menu">',a.country.forEach(e=>{o+=`<li><a href="${e.url}" class="flex items-center gap-2"><span>\u{1F30D}</span><span>${e.name}</span></a></li>`}),o+="</ul></div>"),a.state.length>0&&(o+='<div class="mb-4"><h4 class="font-semibold text-sm mb-2 text-base-content/60">States / Regions</h4><ul class="menu">',a.state.forEach(e=>{o+=`<li><a href="${e.url}" class="flex items-center gap-2"><span>\u{1F4CD}</span><span>${e.name}</span><span class="text-xs text-base-content/60">${e.country}</span></a></li>`}),o+="</ul></div>"),a.resort.length>0&&(o+='<div class="mb-4"><h4 class="font-semibold text-sm mb-2 text-base-content/60">Ski Resorts</h4><ul class="menu">',a.resort.forEach(e=>{o+=`<li><a href="${e.url}" class="flex items-center gap-2"><span>\u26F7\uFE0F</span><div class="flex flex-col items-start"><span>${e.name}</span><span class="text-xs text-base-content/60">${e.state}, ${e.country}</span></div></a></li>`}),o+="</ul></div>"),f.innerHTML=o}function E(t,n){let s;return function(...o){let e=()=>{clearTimeout(s),t(...o)};clearTimeout(s),s=setTimeout(e,n)}}let S=E(x,300);b.addEventListener("click",()=>{c.showModal(),w(),u.focus()});function I(){if(!window.visualViewport)return;let t=c.querySelector(".modal-box");t&&(window.visualViewport.addEventListener("resize",()=>{if(c.open){let n=window.visualViewport.height;t.style.maxHeight=`${n-20}px`}}),window.visualViewport.addEventListener("scroll",()=>{c.open&&(t.style.transform=`translateY(${window.visualViewport.offsetTop}px)`)}))}I(),u.addEventListener("input",t=>{S(t.target.value)}),c.addEventListener("close",()=>{u.value="",f.innerHTML="",m.classList.add("hidden");let t=c.querySelector(".modal-box");t&&(t.style.maxHeight="",t.style.transform="")}),document.addEventListener("keydown",t=>{(t.metaKey||t.ctrlKey)&&t.key==="k"&&(t.preventDefault(),c.showModal(),w(),u.focus())})})();})();
